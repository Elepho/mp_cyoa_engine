<!DOCTYPE html>
<html>
    <head>
        <title>WebSocket demo</title>
    </head>
    <body>
    <p>this is a test page, does not reflect final product</p>
    <button type="button" class="newevent">Get new event from server</button>

        <script>
        
        function DisplayEvent(game_event,ws){
            eventbox=document.createElement('div')
            
            title=document.createElement('b')
            title.innerHTML = game_event.title
            eventbox.appendChild(title)
            
            desc=document.createElement('p')
            desc.innerHTML = game_event.description
            eventbox.appendChild(desc)
            
            choicebox=document.createElement('div')
            game_event.options.forEach(function(element){
                choicebutton=document.createElement('button')
                choicebutton.innerHTML=element[0]
                choicebutton.onclick=function(event){
                    ws.send(JSON.stringify({action: element[1], new_event: element[2]}))
                }
                choicebox.appendChild(choicebutton)
            })            
            eventbox.appendChild(choicebox)
            return(eventbox)
        }
        
        
        var ws = new WebSocket("ws://127.0.0.1:5678/");
        var ev_holder = document.createElement('div');
        ws.onmessage = function (event) {
        
            while(ev_holder.firstChild){
                ev_holder.removeChild(ev_holder.firstChild);
            }
                     
            <!-- console.log(JSON.parse(JSON.parse(event.data))) -->
            
            GameEventBox=DisplayEvent(JSON.parse(JSON.parse(event.data)),ws)
            
            ev_holder.appendChild(GameEventBox)
            
        };
        document.body.appendChild(ev_holder);
        
        newevent_button=document.querySelector(".newevent");
        
        newevent_button.onclick=function(event){
            ws.send(JSON.stringify({action: 'newevent'}));
        }
            
            
            
        </script>
    </body>
</html>