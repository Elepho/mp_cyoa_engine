<!DOCTYPE html>
<html>
    <head>
        <title>WebSocket demo</title>
    </head>
    <body>
    <p>Current task: this page receives lists of numbers.  Replace each list with a new list when it is received, formatted as an unordered list.  Button gets new list from server</p>
    <button type="button" class="newevent">Get new event from server</button>

        <script>
        
        function DisplayEvent(game_event,ws){
            eventbox=document.createElement('div')
            
            title=document.createElement('b')
            title.innerHTML = game_event.title
            eventbox.appendChild(title)
            
            desc=document.createElement('p')
            desc.innerHTML = game_event.description
            eventbox.appendChild(desc)
            
            choicebox=document.createElement('div')
            game_event.options.forEach(function(element){
                choicebutton=document.createElement('button')
                choicebutton.innerHTML=element[0]
                choicebutton.onclick=function(event){
                    ws.send(JSON.stringify({action: element[1]}))
                }
                choicebox.appendChild(choicebutton)
            })            
            eventbox.appendChild(choicebox)
            return(eventbox)
        }
        
        
        var ws = new WebSocket("ws://127.0.0.1:5678/"),
            numlist = document.createElement('ul');
        ws.onmessage = function (event) {
        
            //delete all children of ul
            while(numlist.firstChild){
                numlist.removeChild(numlist.firstChild);
            }
                            
            <!-- dat=JSON.parse(event.data) -->
            
            <!-- dat.forEach(function(element){ -->
                <!-- // list_el is the element we create to hold an element -->
                <!-- var list_el = document.createElement('li'); -->
                <!-- // content is the thing we stuff we get from the data -->
                <!-- var content = document.createTextNode(element); -->
                <!-- list_el.appendChild(content); -->
                <!-- numlist.appendChild(list_el); -->
            <!-- }); -->
            
            console.log(JSON.parse(JSON.parse(event.data)))
            
            GameEventBox=DisplayEvent(JSON.parse(JSON.parse(event.data)),ws)
            
            document.body.appendChild(GameEventBox)
            
        };
        document.body.appendChild(numlist);
        
        newevent_button=document.querySelector(".newevent");
        
        newevent_button.onclick=function(event){
            ws.send(JSON.stringify({action: 'newevent'}));
        }
            
            
            
        </script>
    </body>
</html>